<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Joost de Theije + LLM">
<meta name="dcterms.date" content="2024-02-11">

<title>Introduction to Partial Dependence Plots â€“ hyper-shotgun</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../favicons/hyper_favi.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-65186549de95cd2ff331b98fa30c8ceb.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-452e721b62d9123c4b614c43ab971082.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-c49d385b090d22846363425bc58f6809.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-3a168564333137508c75f12822f0da06.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../apple-touch-icon.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">hyper-shotgun</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../whois.html"> 
<span class="menu-text">whois ðŸ¤–</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.linkedin.com/in/joostdetheije/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text">LinkedIn</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/jope35"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text">Github</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Introduction to Partial Dependence Plots</h1>
            <p class="subtitle lead">Visualizing Model Relationships</p>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Joost de Theije + LLM </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">February 11, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  <div>
    <div class="abstract">
      <div class="block-title">Abstract</div>
      This article provides an overview of Partial Dependence Plots (PDPs) and Individual Conditional Expectation (ICE) plots, powerful tools for visualizing the relationships between features and predictions in machine learning models. Weâ€™ll explore how these plots can help to interpret model behavior, revealing both average effects and individual data point responses.
    </div>
  </div>
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a></li>
  <li><a href="#why-explore-partial-dependence-plots" id="toc-why-explore-partial-dependence-plots" class="nav-link" data-scroll-target="#why-explore-partial-dependence-plots"><span class="header-section-number">2</span> Why Explore Partial Dependence Plots?</a></li>
  <li><a href="#step-by-step-guide-to-calculating-a-partial-dependence-plot-pdp" id="toc-step-by-step-guide-to-calculating-a-partial-dependence-plot-pdp" class="nav-link" data-scroll-target="#step-by-step-guide-to-calculating-a-partial-dependence-plot-pdp"><span class="header-section-number">3</span> Step-by-Step Guide to Calculating a Partial Dependence Plot (PDP)</a>
  <ul class="collapse">
  <li><a href="#identify-the-range-of-the-feature" id="toc-identify-the-range-of-the-feature" class="nav-link" data-scroll-target="#identify-the-range-of-the-feature"><span class="header-section-number">3.1</span> Identify the Range of the Feature</a></li>
  <li><a href="#determine-the-grid-size" id="toc-determine-the-grid-size" class="nav-link" data-scroll-target="#determine-the-grid-size"><span class="header-section-number">3.2</span> Determine the Grid Size</a></li>
  <li><a href="#expand-the-dataset-using-the-grid" id="toc-expand-the-dataset-using-the-grid" class="nav-link" data-scroll-target="#expand-the-dataset-using-the-grid"><span class="header-section-number">3.3</span> Expand the Dataset Using the Grid</a></li>
  <li><a href="#generate-predictions" id="toc-generate-predictions" class="nav-link" data-scroll-target="#generate-predictions"><span class="header-section-number">3.4</span> Generate Predictions</a></li>
  <li><a href="#compute-the-average" id="toc-compute-the-average" class="nav-link" data-scroll-target="#compute-the-average"><span class="header-section-number">3.5</span> Compute the Average</a></li>
  </ul></li>
  <li><a href="#interpreting-the-partial-dependence-plot" id="toc-interpreting-the-partial-dependence-plot" class="nav-link" data-scroll-target="#interpreting-the-partial-dependence-plot"><span class="header-section-number">4</span> Interpreting the Partial Dependence Plot</a></li>
  <li><a href="#implementation-in-code" id="toc-implementation-in-code" class="nav-link" data-scroll-target="#implementation-in-code"><span class="header-section-number">5</span> Implementation in Code</a>
  <ul class="collapse">
  <li><a href="#utilizing-existing-libraries-for-partial-dependence-plots" id="toc-utilizing-existing-libraries-for-partial-dependence-plots" class="nav-link" data-scroll-target="#utilizing-existing-libraries-for-partial-dependence-plots"><span class="header-section-number">5.1</span> Utilizing Existing Libraries for Partial Dependence Plots</a></li>
  <li><a href="#one-way-partial-dependence" id="toc-one-way-partial-dependence" class="nav-link" data-scroll-target="#one-way-partial-dependence"><span class="header-section-number">5.2</span> one-way partial dependence</a></li>
  <li><a href="#insights-from-the-partial-dependence-plot-analysis" id="toc-insights-from-the-partial-dependence-plot-analysis" class="nav-link" data-scroll-target="#insights-from-the-partial-dependence-plot-analysis"><span class="header-section-number">5.3</span> Insights from the Partial Dependence Plot Analysis</a></li>
  <li><a href="#exploring-feature-interactions-with-two-way-partial-dependence-plots" id="toc-exploring-feature-interactions-with-two-way-partial-dependence-plots" class="nav-link" data-scroll-target="#exploring-feature-interactions-with-two-way-partial-dependence-plots"><span class="header-section-number">5.4</span> Exploring Feature Interactions with Two-Way Partial Dependence Plots</a></li>
  </ul></li>
  <li><a href="#bonus-individual-conditional-expectation" id="toc-bonus-individual-conditional-expectation" class="nav-link" data-scroll-target="#bonus-individual-conditional-expectation"><span class="header-section-number">6</span> Bonus: Individual Conditional Expectation ðŸ§Š</a>
  <ul class="collapse">
  <li><a href="#focused-on-the-individual" id="toc-focused-on-the-individual" class="nav-link" data-scroll-target="#focused-on-the-individual"><span class="header-section-number">6.1</span> Focused on the Individual</a></li>
  <li><a href="#visual-diagnosis-of-variability" id="toc-visual-diagnosis-of-variability" class="nav-link" data-scroll-target="#visual-diagnosis-of-variability"><span class="header-section-number">6.2</span> Visual Diagnosis of Variability</a></li>
  <li><a href="#enhanced-model-understanding" id="toc-enhanced-model-understanding" class="nav-link" data-scroll-target="#enhanced-model-understanding"><span class="header-section-number">6.3</span> Enhanced Model Understanding</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<div id="cell-1" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="im">from</span> matplotlib_inline.backend_inline <span class="im">import</span> set_matplotlib_formats</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="im">from</span> sklearn.datasets <span class="im">import</span> make_friedman1</span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor</span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="im">from</span> sklearn.inspection <span class="im">import</span> PartialDependenceDisplay, partial_dependence</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-2" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a><span class="im">import</span> warnings</span>
<span id="cb2-2"><a href="#cb2-2"></a></span>
<span id="cb2-3"><a href="#cb2-3"></a>warnings.filterwarnings(<span class="st">"ignore"</span>, category<span class="op">=</span><span class="pp">UserWarning</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-3" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># setting global plotting settings</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="co"># roudning all floats to two digits</span></span>
<span id="cb3-3"><a href="#cb3-3"></a>pd.options.display.float_format <span class="op">=</span> <span class="st">"</span><span class="sc">{:.2f}</span><span class="st">"</span>.<span class="bu">format</span></span>
<span id="cb3-4"><a href="#cb3-4"></a></span>
<span id="cb3-5"><a href="#cb3-5"></a>set_matplotlib_formats(<span class="st">"svg"</span>)</span>
<span id="cb3-6"><a href="#cb3-6"></a>sns.set_context(context<span class="op">=</span><span class="st">"notebook"</span>, font_scale<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb3-7"><a href="#cb3-7"></a>sns.set_palette(<span class="st">"tab10"</span>)</span>
<span id="cb3-8"><a href="#cb3-8"></a>sns.set_style(<span class="st">"darkgrid"</span>)</span>
<span id="cb3-9"><a href="#cb3-9"></a>FIGSIZE <span class="op">=</span> (<span class="dv">12</span>, <span class="dv">6</span>)</span>
<span id="cb3-10"><a href="#cb3-10"></a>RANDOM_STATE <span class="op">=</span> <span class="dv">35</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="introduction" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">1</span> Introduction</h2>
<p>Letâ€™s dive into the world of partial dependence plots (PDPs), powerful visual tools that reveal the average impact a specific feature has on the predictions made by a model.</p>
</section>
<section id="why-explore-partial-dependence-plots" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="why-explore-partial-dependence-plots"><span class="header-section-number">2</span> Why Explore Partial Dependence Plots?</h2>
<p>Visualizing how different features influence model predictions can be crucial for understanding, interpreting, and trusting the decisions made by machine learning models. PDPs help us gain insights into the relationship between the features and the predicted outcomes.</p>
<p>To illustrate the concept of PDPs, we will use a synthetic dataset from Scikit-learn, available <a href="https://scikit-learn.org/stable/modules/generated/sklearn.datasets.make_friedman1.html#sklearn.datasets.make_friedman1">here</a>.</p>
<p>The synthetic dataset is created based on the following formula: <span class="math inline">\(y(X) = 10\sin(\pi \cdot X_0 \cdot X_1) + 20 \cdot (X_2 - 0.5)^2 + 10 \cdot X_3 + 5 \cdot X_4 + \text{noise} \cdot N(0, 1)\)</span>.</p>
<p>For our demonstration, I will generate a dataset with 7 features. However, itâ€™s important to note that only 5 of these features actually affect the outputâ€”this means the other two features do not have any predictive power. The dataset will contain 2000 samples and include a noise level set to 2.</p>
<div id="cell-5" class="cell" data-execution_count="4">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a>X_reg, y_reg <span class="op">=</span> make_friedman1(</span>
<span id="cb4-2"><a href="#cb4-2"></a>    n_samples<span class="op">=</span><span class="dv">2_000</span>, n_features<span class="op">=</span><span class="dv">7</span>, noise<span class="op">=</span><span class="dv">2</span>, random_state<span class="op">=</span>RANDOM_STATE</span>
<span id="cb4-3"><a href="#cb4-3"></a>)</span>
<span id="cb4-4"><a href="#cb4-4"></a></span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="co"># stick it into a dataframe</span></span>
<span id="cb4-6"><a href="#cb4-6"></a>df_reg <span class="op">=</span> pd.concat(</span>
<span id="cb4-7"><a href="#cb4-7"></a>    [</span>
<span id="cb4-8"><a href="#cb4-8"></a>        pd.DataFrame(</span>
<span id="cb4-9"><a href="#cb4-9"></a>            data<span class="op">=</span>X_reg, columns<span class="op">=</span>[<span class="st">"x_0"</span>, <span class="st">"x_1"</span>, <span class="st">"x_2"</span>, <span class="st">"x_3"</span>, <span class="st">"x_4"</span>, <span class="st">"x_5"</span>, <span class="st">"x_6"</span>]</span>
<span id="cb4-10"><a href="#cb4-10"></a>        ),</span>
<span id="cb4-11"><a href="#cb4-11"></a>        pd.DataFrame(data<span class="op">=</span>y_reg, columns<span class="op">=</span>[<span class="st">"target"</span>]),</span>
<span id="cb4-12"><a href="#cb4-12"></a>    ],</span>
<span id="cb4-13"><a href="#cb4-13"></a>    axis<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb4-14"><a href="#cb4-14"></a>)</span>
<span id="cb4-15"><a href="#cb4-15"></a></span>
<span id="cb4-16"><a href="#cb4-16"></a><span class="co"># display descriptive stats</span></span>
<span id="cb4-17"><a href="#cb4-17"></a>df_reg.describe().T</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">min</th>
<th data-quarto-table-cell-role="th">25%</th>
<th data-quarto-table-cell-role="th">50%</th>
<th data-quarto-table-cell-role="th">75%</th>
<th data-quarto-table-cell-role="th">max</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">x_0</td>
<td>2000.00</td>
<td>0.49</td>
<td>0.29</td>
<td>0.00</td>
<td>0.25</td>
<td>0.49</td>
<td>0.74</td>
<td>1.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">x_1</td>
<td>2000.00</td>
<td>0.50</td>
<td>0.29</td>
<td>0.00</td>
<td>0.25</td>
<td>0.51</td>
<td>0.76</td>
<td>1.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">x_2</td>
<td>2000.00</td>
<td>0.50</td>
<td>0.29</td>
<td>0.00</td>
<td>0.25</td>
<td>0.52</td>
<td>0.75</td>
<td>1.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">x_3</td>
<td>2000.00</td>
<td>0.50</td>
<td>0.28</td>
<td>0.00</td>
<td>0.26</td>
<td>0.51</td>
<td>0.75</td>
<td>1.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">x_4</td>
<td>2000.00</td>
<td>0.50</td>
<td>0.29</td>
<td>0.00</td>
<td>0.25</td>
<td>0.50</td>
<td>0.75</td>
<td>1.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">x_5</td>
<td>2000.00</td>
<td>0.50</td>
<td>0.29</td>
<td>0.00</td>
<td>0.24</td>
<td>0.49</td>
<td>0.75</td>
<td>1.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">x_6</td>
<td>2000.00</td>
<td>0.50</td>
<td>0.28</td>
<td>0.00</td>
<td>0.26</td>
<td>0.51</td>
<td>0.75</td>
<td>1.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">target</td>
<td>2000.00</td>
<td>14.48</td>
<td>5.26</td>
<td>-1.56</td>
<td>10.72</td>
<td>14.46</td>
<td>18.15</td>
<td>30.51</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The datasetâ€™s input features are uniformly distributed, <span class="math inline">\(U(0,1)\)</span>, which typically means their average value hovers around 0.5. In contrast, our target feature stands out with a much higher average value of approximately 14.</p>
<p>For our analysis, weâ€™ll be using a random forest model. Itâ€™s <a href="https://www.linkedin.com/feed/update/urn:li:activity:7169278449243607041?updateEntityUrn=urn%3Ali%3Afs_feedUpdate%3A%28V2%2Curn%3Ali%3Aactivity%3A7169278449243607041%29">my go-to favorite</a> for several reasons: no need for feature scaling, robustness to missing values, and its proficiency in capturing non-linear relationships. Plus, it has the added advantage of relatively quick fitting times.</p>
<div id="cell-7" class="cell" data-execution_count="5">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a>X <span class="op">=</span> df_reg.drop(columns<span class="op">=</span><span class="st">"target"</span>)</span>
<span id="cb5-2"><a href="#cb5-2"></a>y <span class="op">=</span> df_reg[<span class="st">"target"</span>]</span>
<span id="cb5-3"><a href="#cb5-3"></a></span>
<span id="cb5-4"><a href="#cb5-4"></a>reg <span class="op">=</span> RandomForestRegressor(</span>
<span id="cb5-5"><a href="#cb5-5"></a>    n_estimators<span class="op">=</span><span class="dv">32</span>,</span>
<span id="cb5-6"><a href="#cb5-6"></a>    max_depth<span class="op">=</span><span class="dv">9</span>,</span>
<span id="cb5-7"><a href="#cb5-7"></a>    min_samples_split<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb5-8"><a href="#cb5-8"></a>    random_state<span class="op">=</span><span class="dv">42</span>,</span>
<span id="cb5-9"><a href="#cb5-9"></a>)</span>
<span id="cb5-10"><a href="#cb5-10"></a>_ <span class="op">=</span> reg.fit(X, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Before examining the partial dependence of each feature on the target, letâ€™s first handle some data preparation. A practical approach is to begin with a small random sample of our data. After working through an end-to-end example using this subset, we can consider applying the same method to the larger dataset.</p>
<div id="cell-9" class="cell" data-execution_count="6">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a>df_sample <span class="op">=</span> df_reg.sample(<span class="dv">3</span>, random_state<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb6-2"><a href="#cb6-2"></a>df_sample</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="6">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">x_0</th>
<th data-quarto-table-cell-role="th">x_1</th>
<th data-quarto-table-cell-role="th">x_2</th>
<th data-quarto-table-cell-role="th">x_3</th>
<th data-quarto-table-cell-role="th">x_4</th>
<th data-quarto-table-cell-role="th">x_5</th>
<th data-quarto-table-cell-role="th">x_6</th>
<th data-quarto-table-cell-role="th">target</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">674</td>
<td>0.36</td>
<td>0.70</td>
<td>0.83</td>
<td>0.03</td>
<td>0.26</td>
<td>0.53</td>
<td>0.61</td>
<td>12.79</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1699</td>
<td>0.32</td>
<td>0.70</td>
<td>0.38</td>
<td>0.02</td>
<td>0.38</td>
<td>0.40</td>
<td>0.14</td>
<td>8.29</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1282</td>
<td>0.31</td>
<td>0.21</td>
<td>0.66</td>
<td>0.40</td>
<td>0.27</td>
<td>0.11</td>
<td>0.84</td>
<td>7.57</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="step-by-step-guide-to-calculating-a-partial-dependence-plot-pdp" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="step-by-step-guide-to-calculating-a-partial-dependence-plot-pdp"><span class="header-section-number">3</span> Step-by-Step Guide to Calculating a Partial Dependence Plot (PDP)</h2>
<p>To determine the partial dependence (PD) of a feature, such as <code>x_0</code>, on the predicted outcome, we follow a structured process:</p>
<ol type="1">
<li><p><strong>Identify the Range of the Feature</strong>: Ascertain the range within which the feature <code>x_0</code> varies. For most datasets, this would be the minimum and maximum values that <code>x_0</code> can take.</p></li>
<li><p><strong>Determine the Grid Size</strong>: Decide on a grid size, which essentially is the number of points or the sampling resolution across the featureâ€™s range.</p></li>
<li><p><strong>Expand the Dataset Using the Grid</strong>: Implement the grid across the dataset. This step significantly increases the size of the dataset because for each original data point, we now have multiple points covering the entire grid.</p></li>
<li><p><strong>Generate Predictions</strong>: Use the model to predict outcomes on this augmented dataset. These predictions are solely for inference, which generally has a lower computational cost.</p></li>
<li><p><strong>Compute the Average</strong>: Take the mean of the predictions corresponding to each value on the grid. This average is what gives us the partial dependence value at each point.</p></li>
</ol>
<p>Through this method, we can illustrate how changes in <code>x_0</code> influence the modelâ€™s predictions, regardless of the values of other features. This visual representation helps in understanding the behavior and decision-making process of complex models.</p>
<section id="identify-the-range-of-the-feature" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="identify-the-range-of-the-feature"><span class="header-section-number">3.1</span> Identify the Range of the Feature</h3>
<div id="cell-12" class="cell" data-execution_count="7">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1"></a>df_reg[<span class="st">"x_0"</span>].agg([<span class="st">"min"</span>, <span class="st">"max"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>min   0.00
max   1.00
Name: x_0, dtype: float64</code></pre>
</div>
</div>
<p>When calculating the partial dependence of <code>x_0</code>, which ranges from zero to one, you have the option to consider the entire range of values <code>x_0</code> can take or focus on a specific region, such as the 90th percentile. The latter approach eliminates potential outliers that may skew the PD calculation.</p>
</section>
<section id="determine-the-grid-size" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="determine-the-grid-size"><span class="header-section-number">3.2</span> Determine the Grid Size</h3>
<p>For this particular analysis, weâ€™re opting for a modest grid size of 7. This means weâ€™ll create a sequence of 7 points that are evenly spaced across the feature <code>x_0</code> range of 0 to 1.</p>
</section>
<section id="expand-the-dataset-using-the-grid" class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="expand-the-dataset-using-the-grid"><span class="header-section-number">3.3</span> Expand the Dataset Using the Grid</h3>
<p>Using the <code>np.linspace()</code> function in Python, we can easily generate our grid. This function creates an array of evenly spaced values over a specified interval. Once we have our grid, we can augment our dataset through a cross join operation. For those familiar with SQL, itâ€™s common knowledge that cross joins can rapidly increase the size of your data. With 3 original data points and a grid size of 7, we increase our data count to ($ 3 = 21$ ). In this expanded dataset, the new column <code>x_0_sample</code> represents the values for <code>x_0</code> across which we want to compute the partial dependence.</p>
<div id="cell-15" class="cell" data-execution_count="8">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1"></a>df_pdp <span class="op">=</span> df_sample.drop(columns<span class="op">=</span><span class="st">"x_0"</span>)</span>
<span id="cb9-2"><a href="#cb9-2"></a>df_sample_grid <span class="op">=</span> pd.Series(np.linspace(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">7</span>), name<span class="op">=</span><span class="st">"x_0_sample"</span>).<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb9-3"><a href="#cb9-3"></a>df_pdp <span class="op">=</span> df_pdp.join(other<span class="op">=</span>df_sample_grid, how<span class="op">=</span><span class="st">"cross"</span>)</span>
<span id="cb9-4"><a href="#cb9-4"></a>df_pdp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="8">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">x_1</th>
<th data-quarto-table-cell-role="th">x_2</th>
<th data-quarto-table-cell-role="th">x_3</th>
<th data-quarto-table-cell-role="th">x_4</th>
<th data-quarto-table-cell-role="th">x_5</th>
<th data-quarto-table-cell-role="th">x_6</th>
<th data-quarto-table-cell-role="th">target</th>
<th data-quarto-table-cell-role="th">x_0_sample</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.70</td>
<td>0.83</td>
<td>0.03</td>
<td>0.26</td>
<td>0.53</td>
<td>0.61</td>
<td>12.79</td>
<td>0.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.70</td>
<td>0.83</td>
<td>0.03</td>
<td>0.26</td>
<td>0.53</td>
<td>0.61</td>
<td>12.79</td>
<td>0.17</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.70</td>
<td>0.83</td>
<td>0.03</td>
<td>0.26</td>
<td>0.53</td>
<td>0.61</td>
<td>12.79</td>
<td>0.33</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0.70</td>
<td>0.83</td>
<td>0.03</td>
<td>0.26</td>
<td>0.53</td>
<td>0.61</td>
<td>12.79</td>
<td>0.50</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0.70</td>
<td>0.83</td>
<td>0.03</td>
<td>0.26</td>
<td>0.53</td>
<td>0.61</td>
<td>12.79</td>
<td>0.67</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>0.70</td>
<td>0.83</td>
<td>0.03</td>
<td>0.26</td>
<td>0.53</td>
<td>0.61</td>
<td>12.79</td>
<td>0.83</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>0.70</td>
<td>0.83</td>
<td>0.03</td>
<td>0.26</td>
<td>0.53</td>
<td>0.61</td>
<td>12.79</td>
<td>1.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>0.70</td>
<td>0.38</td>
<td>0.02</td>
<td>0.38</td>
<td>0.40</td>
<td>0.14</td>
<td>8.29</td>
<td>0.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>0.70</td>
<td>0.38</td>
<td>0.02</td>
<td>0.38</td>
<td>0.40</td>
<td>0.14</td>
<td>8.29</td>
<td>0.17</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>0.70</td>
<td>0.38</td>
<td>0.02</td>
<td>0.38</td>
<td>0.40</td>
<td>0.14</td>
<td>8.29</td>
<td>0.33</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>0.70</td>
<td>0.38</td>
<td>0.02</td>
<td>0.38</td>
<td>0.40</td>
<td>0.14</td>
<td>8.29</td>
<td>0.50</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>0.70</td>
<td>0.38</td>
<td>0.02</td>
<td>0.38</td>
<td>0.40</td>
<td>0.14</td>
<td>8.29</td>
<td>0.67</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>0.70</td>
<td>0.38</td>
<td>0.02</td>
<td>0.38</td>
<td>0.40</td>
<td>0.14</td>
<td>8.29</td>
<td>0.83</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>0.70</td>
<td>0.38</td>
<td>0.02</td>
<td>0.38</td>
<td>0.40</td>
<td>0.14</td>
<td>8.29</td>
<td>1.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>0.21</td>
<td>0.66</td>
<td>0.40</td>
<td>0.27</td>
<td>0.11</td>
<td>0.84</td>
<td>7.57</td>
<td>0.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>0.21</td>
<td>0.66</td>
<td>0.40</td>
<td>0.27</td>
<td>0.11</td>
<td>0.84</td>
<td>7.57</td>
<td>0.17</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>0.21</td>
<td>0.66</td>
<td>0.40</td>
<td>0.27</td>
<td>0.11</td>
<td>0.84</td>
<td>7.57</td>
<td>0.33</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>0.21</td>
<td>0.66</td>
<td>0.40</td>
<td>0.27</td>
<td>0.11</td>
<td>0.84</td>
<td>7.57</td>
<td>0.50</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>0.21</td>
<td>0.66</td>
<td>0.40</td>
<td>0.27</td>
<td>0.11</td>
<td>0.84</td>
<td>7.57</td>
<td>0.67</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>0.21</td>
<td>0.66</td>
<td>0.40</td>
<td>0.27</td>
<td>0.11</td>
<td>0.84</td>
<td>7.57</td>
<td>0.83</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>0.21</td>
<td>0.66</td>
<td>0.40</td>
<td>0.27</td>
<td>0.11</td>
<td>0.84</td>
<td>7.57</td>
<td>1.00</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="generate-predictions" class="level3" data-number="3.4">
<h3 data-number="3.4" class="anchored" data-anchor-id="generate-predictions"><span class="header-section-number">3.4</span> Generate Predictions</h3>
<p>With our expanded dataset, now consisting of 21 observations, we move forward by utilizing our model to generate predictions for each observation. In essence, we ask the original model to provide predictions for every new data point that weâ€™ve added.</p>
<div id="cell-17" class="cell" data-execution_count="9">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1"></a>df_pdp <span class="op">=</span> df_pdp.assign(</span>
<span id="cb10-2"><a href="#cb10-2"></a>    y_pred<span class="op">=</span>reg.predict(</span>
<span id="cb10-3"><a href="#cb10-3"></a>        df_pdp.loc[</span>
<span id="cb10-4"><a href="#cb10-4"></a>            :, [<span class="st">"x_0_sample"</span>, <span class="st">"x_1"</span>, <span class="st">"x_2"</span>, <span class="st">"x_3"</span>, <span class="st">"x_4"</span>, <span class="st">"x_5"</span>, <span class="st">"x_6"</span>]</span>
<span id="cb10-5"><a href="#cb10-5"></a>        ].to_numpy()</span>
<span id="cb10-6"><a href="#cb10-6"></a>    )</span>
<span id="cb10-7"><a href="#cb10-7"></a>)</span>
<span id="cb10-8"><a href="#cb10-8"></a>df_pdp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="9">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">x_1</th>
<th data-quarto-table-cell-role="th">x_2</th>
<th data-quarto-table-cell-role="th">x_3</th>
<th data-quarto-table-cell-role="th">x_4</th>
<th data-quarto-table-cell-role="th">x_5</th>
<th data-quarto-table-cell-role="th">x_6</th>
<th data-quarto-table-cell-role="th">target</th>
<th data-quarto-table-cell-role="th">x_0_sample</th>
<th data-quarto-table-cell-role="th">y_pred</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.70</td>
<td>0.83</td>
<td>0.03</td>
<td>0.26</td>
<td>0.53</td>
<td>0.61</td>
<td>12.79</td>
<td>0.00</td>
<td>5.23</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.70</td>
<td>0.83</td>
<td>0.03</td>
<td>0.26</td>
<td>0.53</td>
<td>0.61</td>
<td>12.79</td>
<td>0.17</td>
<td>9.61</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.70</td>
<td>0.83</td>
<td>0.03</td>
<td>0.26</td>
<td>0.53</td>
<td>0.61</td>
<td>12.79</td>
<td>0.33</td>
<td>12.19</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0.70</td>
<td>0.83</td>
<td>0.03</td>
<td>0.26</td>
<td>0.53</td>
<td>0.61</td>
<td>12.79</td>
<td>0.50</td>
<td>12.58</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0.70</td>
<td>0.83</td>
<td>0.03</td>
<td>0.26</td>
<td>0.53</td>
<td>0.61</td>
<td>12.79</td>
<td>0.67</td>
<td>12.72</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>0.70</td>
<td>0.83</td>
<td>0.03</td>
<td>0.26</td>
<td>0.53</td>
<td>0.61</td>
<td>12.79</td>
<td>0.83</td>
<td>12.66</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>0.70</td>
<td>0.83</td>
<td>0.03</td>
<td>0.26</td>
<td>0.53</td>
<td>0.61</td>
<td>12.79</td>
<td>1.00</td>
<td>12.79</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>0.70</td>
<td>0.38</td>
<td>0.02</td>
<td>0.38</td>
<td>0.40</td>
<td>0.14</td>
<td>8.29</td>
<td>0.00</td>
<td>5.76</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>0.70</td>
<td>0.38</td>
<td>0.02</td>
<td>0.38</td>
<td>0.40</td>
<td>0.14</td>
<td>8.29</td>
<td>0.17</td>
<td>9.31</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>0.70</td>
<td>0.38</td>
<td>0.02</td>
<td>0.38</td>
<td>0.40</td>
<td>0.14</td>
<td>8.29</td>
<td>0.33</td>
<td>9.89</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>0.70</td>
<td>0.38</td>
<td>0.02</td>
<td>0.38</td>
<td>0.40</td>
<td>0.14</td>
<td>8.29</td>
<td>0.50</td>
<td>11.27</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>0.70</td>
<td>0.38</td>
<td>0.02</td>
<td>0.38</td>
<td>0.40</td>
<td>0.14</td>
<td>8.29</td>
<td>0.67</td>
<td>11.67</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>0.70</td>
<td>0.38</td>
<td>0.02</td>
<td>0.38</td>
<td>0.40</td>
<td>0.14</td>
<td>8.29</td>
<td>0.83</td>
<td>11.60</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>0.70</td>
<td>0.38</td>
<td>0.02</td>
<td>0.38</td>
<td>0.40</td>
<td>0.14</td>
<td>8.29</td>
<td>1.00</td>
<td>11.86</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>0.21</td>
<td>0.66</td>
<td>0.40</td>
<td>0.27</td>
<td>0.11</td>
<td>0.84</td>
<td>7.57</td>
<td>0.00</td>
<td>6.65</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>0.21</td>
<td>0.66</td>
<td>0.40</td>
<td>0.27</td>
<td>0.11</td>
<td>0.84</td>
<td>7.57</td>
<td>0.17</td>
<td>6.97</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>0.21</td>
<td>0.66</td>
<td>0.40</td>
<td>0.27</td>
<td>0.11</td>
<td>0.84</td>
<td>7.57</td>
<td>0.33</td>
<td>7.73</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>0.21</td>
<td>0.66</td>
<td>0.40</td>
<td>0.27</td>
<td>0.11</td>
<td>0.84</td>
<td>7.57</td>
<td>0.50</td>
<td>9.19</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>0.21</td>
<td>0.66</td>
<td>0.40</td>
<td>0.27</td>
<td>0.11</td>
<td>0.84</td>
<td>7.57</td>
<td>0.67</td>
<td>9.91</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>0.21</td>
<td>0.66</td>
<td>0.40</td>
<td>0.27</td>
<td>0.11</td>
<td>0.84</td>
<td>7.57</td>
<td>0.83</td>
<td>10.83</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>0.21</td>
<td>0.66</td>
<td>0.40</td>
<td>0.27</td>
<td>0.11</td>
<td>0.84</td>
<td>7.57</td>
<td>1.00</td>
<td>10.82</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="compute-the-average" class="level3" data-number="3.5">
<h3 data-number="3.5" class="anchored" data-anchor-id="compute-the-average"><span class="header-section-number">3.5</span> Compute the Average</h3>
<p>After obtaining predictions, we aggregate results by selecting <code>x_0_sample</code> and <code>y_pred</code>, grouping by <code>x_0_sample</code>, and applying a mean aggregation function to reveal the average impact of changes in <code>x_0</code> on model predictions.</p>
<div id="cell-19" class="cell" data-execution_count="10">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1"></a>df_pdp_plot <span class="op">=</span> (</span>
<span id="cb11-2"><a href="#cb11-2"></a>    df_pdp[[<span class="st">"x_0_sample"</span>, <span class="st">"y_pred"</span>]].groupby(<span class="st">"x_0_sample"</span>, as_index<span class="op">=</span><span class="va">False</span>).mean()</span>
<span id="cb11-3"><a href="#cb11-3"></a>)</span>
<span id="cb11-4"><a href="#cb11-4"></a>df_pdp_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">x_0_sample</th>
<th data-quarto-table-cell-role="th">y_pred</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.00</td>
<td>5.88</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.17</td>
<td>8.63</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.33</td>
<td>9.94</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0.50</td>
<td>11.01</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0.67</td>
<td>11.43</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>0.83</td>
<td>11.70</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>1.00</td>
<td>11.82</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The dataframe shows the average impact of feature <code>x_0</code> on the target variable, with an observable increase in the target variable as <code>x_0</code> values rise, as depicted below.</p>
<!-- Keep in mind that this analysis is based on a limited dataset and coarse grid. To gain a more detailed understanding of the relationship, consider incorporating additional samples from the original dataset and refining the grid for a more nuanced visualization of the dependency between `x_0` and the target variable. Such enhancements can offer deeper insights into how the model's changes for inputs of `x_0`. -->
<div id="cell-21" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1"></a>_, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>FIGSIZE)</span>
<span id="cb12-2"><a href="#cb12-2"></a>ax.plot(df_pdp_plot[<span class="st">"x_0_sample"</span>], df_pdp_plot[<span class="st">"y_pred"</span>])</span>
<span id="cb12-3"><a href="#cb12-3"></a>ax.set_xlabel(<span class="st">"$x_0$"</span>)</span>
<span id="cb12-4"><a href="#cb12-4"></a>ax.set_ylabel(<span class="st">"target"</span>)</span>
<span id="cb12-5"><a href="#cb12-5"></a>ax.set_title(<span class="st">"partial dependence of $x_0$ on the target variable"</span>)</span>
<span id="cb12-6"><a href="#cb12-6"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="dependency_files/figure-html/cell-12-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="interpreting-the-partial-dependence-plot" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="interpreting-the-partial-dependence-plot"><span class="header-section-number">4</span> Interpreting the Partial Dependence Plot</h2>
<p>The plot shows that the model responds positively to increases in <code>x_0</code>. However, this analysis is based on only three observations. To gain a more precise understanding of the relationship between <code>x_0</code> and the target variable, consider utilizing the full dataset of 2000 samples along with a finer grid of 128 points. This expansion results in <span class="math inline">\(2000 * 128 = 256,000\)</span> data points, illustrating the significant data growth when examining partial dependence for just one feature.</p>
<p>By using more data and a refined grid, we can generate a more accurate representation of the <code>x_0</code> variableâ€™s relationship with the target variable.</p>
</section>
<section id="implementation-in-code" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="implementation-in-code"><span class="header-section-number">5</span> Implementation in Code</h2>
<p>Below is the code snippet that will generate this comprehensive dataset. Note the comments indicating where alterations are made to accommodate the full dataset and the finer grid size.</p>
<div id="cell-23" class="cell" data-execution_count="12">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1"></a>df_pdp <span class="op">=</span> df_reg.drop(columns<span class="op">=</span><span class="st">"x_0"</span>)  <span class="co"># &lt;- the full dataset</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>df_sample_grid <span class="op">=</span> pd.Series(</span>
<span id="cb13-3"><a href="#cb13-3"></a>    np.linspace(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">128</span>),  <span class="co"># &lt;- sampling is 128</span></span>
<span id="cb13-4"><a href="#cb13-4"></a>    name<span class="op">=</span><span class="st">"x_0_sample"</span>,</span>
<span id="cb13-5"><a href="#cb13-5"></a>)</span>
<span id="cb13-6"><a href="#cb13-6"></a>df_pdp <span class="op">=</span> df_pdp.join(other<span class="op">=</span>df_sample_grid, how<span class="op">=</span><span class="st">"cross"</span>)</span>
<span id="cb13-7"><a href="#cb13-7"></a></span>
<span id="cb13-8"><a href="#cb13-8"></a>df_pdp <span class="op">=</span> df_pdp.assign(</span>
<span id="cb13-9"><a href="#cb13-9"></a>    y_pred<span class="op">=</span>reg.predict(</span>
<span id="cb13-10"><a href="#cb13-10"></a>        df_pdp.loc[</span>
<span id="cb13-11"><a href="#cb13-11"></a>            :, [<span class="st">"x_0_sample"</span>, <span class="st">"x_1"</span>, <span class="st">"x_2"</span>, <span class="st">"x_3"</span>, <span class="st">"x_4"</span>, <span class="st">"x_5"</span>, <span class="st">"x_6"</span>]</span>
<span id="cb13-12"><a href="#cb13-12"></a>        ].to_numpy()</span>
<span id="cb13-13"><a href="#cb13-13"></a>    )</span>
<span id="cb13-14"><a href="#cb13-14"></a>)</span>
<span id="cb13-15"><a href="#cb13-15"></a></span>
<span id="cb13-16"><a href="#cb13-16"></a>df_pdp_plot_full <span class="op">=</span> (</span>
<span id="cb13-17"><a href="#cb13-17"></a>    df_pdp[[<span class="st">"x_0_sample"</span>, <span class="st">"y_pred"</span>]].groupby(<span class="st">"x_0_sample"</span>, as_index<span class="op">=</span><span class="va">False</span>).mean()</span>
<span id="cb13-18"><a href="#cb13-18"></a>)</span>
<span id="cb13-19"><a href="#cb13-19"></a></span>
<span id="cb13-20"><a href="#cb13-20"></a>_, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>FIGSIZE)</span>
<span id="cb13-21"><a href="#cb13-21"></a>ax.plot(df_pdp_plot_full[<span class="st">"x_0_sample"</span>], df_pdp_plot_full[<span class="st">"y_pred"</span>])</span>
<span id="cb13-22"><a href="#cb13-22"></a>ax.set_xlabel(<span class="st">"$x_0$"</span>)</span>
<span id="cb13-23"><a href="#cb13-23"></a>ax.set_ylabel(<span class="st">"target"</span>)</span>
<span id="cb13-24"><a href="#cb13-24"></a>ax.set_title(<span class="st">"partial dependence of $x_0$ on the target variable"</span>)</span>
<span id="cb13-25"><a href="#cb13-25"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="dependency_files/figure-html/cell-13-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>After utilizing the full dataset of 256,000 samples and applying a more refined grid of 127 points, the resulting plot confirms our earlier findings that as the value of <code>x_0</code> increases, so does the target variable, and this relationship appears to be almost monotonic.</p>
<p>With the increased data resolution, we now have a more granular view confirming and clarifying the positive correlation between <code>x_0</code> and the target variable. This level of detail is invaluable for model interpretation and can guide decisions on feature importance and model adjustments. It underscores the capability of partial dependence plots to provide deeper insights into the modelâ€™s behavior and help pinpoint how specific features drive the predictions.</p>
<section id="utilizing-existing-libraries-for-partial-dependence-plots" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="utilizing-existing-libraries-for-partial-dependence-plots"><span class="header-section-number">5.1</span> Utilizing Existing Libraries for Partial Dependence Plots</h3>
<p>When it comes to practical applications in data science, itâ€™s often more efficient to leverage existing tools and libraries rather than creating custom code from scratch. This is particularly true for partial dependence plots (PDPs), where coding our own routine can be complex and time-consuming.</p>
<p>Scikit-learn, a widely-used library in the machine learning community, offers a convenient and robust implementation of partial dependence with its <a href="https://scikit-learn.org/stable/modules/generated/sklearn.inspection.partial_dependence.html#sklearn.inspection.partial_dependence">partial_dependence</a> function. This can save a substantial amount of effort and helps ensure that our calculations are accurate and aligned with best practices.</p>
<p>Additionally, for those who are already utilizing the SHAP library to compute Shapley valuesâ€”which provide insight into the contribution of each feature to the predictionâ€”thereâ€™s good news. SHAP also includes functionality for generating partial dependence plots with its <a href="https://shap.readthedocs.io/en/latest/generated/shap.plots.partial_dependence.html">shap.plots.partial_dependence</a> feature. This is extremely beneficial as it integrates seamlessly with other SHAP-based interpretability techniques, offering a consistent and comprehensive suite of tools for model explanation.</p>
<p>These existing implementations not only streamline the process but also ensure that youâ€™re taking advantage of the latest methodologies and optimizations in the field. Whether youâ€™re conducting exploratory data analysis or presenting findings to stakeholders, these tools can greatly enhance the efficiency and clarity of your model interpretation efforts.</p>
</section>
<section id="one-way-partial-dependence" class="level3" data-number="5.2">
<h3 data-number="5.2" class="anchored" data-anchor-id="one-way-partial-dependence"><span class="header-section-number">5.2</span> one-way partial dependence</h3>
<p>The beauty of using scikit-learnâ€™s built-in functions lies in their simplicity and power. Generating partial dependence plots for your entire dataset can indeed be as straightforward as a single line of code. Scikit-learn takes care of the heavy lifting involved in computing the partial dependence and plotting it. This function will automatically handle the grid creation, predictions, and averaging needed to generate the PDP. The resulting plot is a powerful visual tool that can instantly convey how changes in the specified feature(s) affect the modelâ€™s output, facilitating a better understanding of the modelâ€™s behavior.</p>
<p>This ease of use, combined with the robustness of scikit-learn, makes it a go-to choice for practitioners looking to interpret their machine learning models without getting bogged down in the details of implementation. ðŸ˜Š</p>
<div id="cell-28" class="cell" data-execution_count="13">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1"></a>_, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">16</span>))</span>
<span id="cb14-2"><a href="#cb14-2"></a></span>
<span id="cb14-3"><a href="#cb14-3"></a>PartialDependenceDisplay.from_estimator(</span>
<span id="cb14-4"><a href="#cb14-4"></a>    estimator<span class="op">=</span>reg, X<span class="op">=</span>X, features<span class="op">=</span><span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">7</span>), grid_resolution<span class="op">=</span><span class="dv">128</span>, kind<span class="op">=</span><span class="st">"average"</span>, ax<span class="op">=</span>ax</span>
<span id="cb14-5"><a href="#cb14-5"></a>)</span>
<span id="cb14-6"><a href="#cb14-6"></a>plt.tight_layout()</span>
<span id="cb14-7"><a href="#cb14-7"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="dependency_files/figure-html/cell-14-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="insights-from-the-partial-dependence-plot-analysis" class="level3" data-number="5.3">
<h3 data-number="5.3" class="anchored" data-anchor-id="insights-from-the-partial-dependence-plot-analysis"><span class="header-section-number">5.3</span> Insights from the Partial Dependence Plot Analysis</h3>
<p>The partial dependence plots provide a wealth of insights into how different features impact the modelâ€™s predictions. Based on the plot, we can make several observations:</p>
<ul>
<li><p><strong>Features <code>x_6</code> and <code>x_5</code></strong>: These features appear to have no meaningful impact on the modelâ€™s output. Variations in <code>x_6</code> or <code>x_5</code> do not significantly alter the predicted target value. This aligns with our earlier understanding that these features represent random noise, thus confirming their lack of predictive power.</p></li>
<li><p><strong>Feature <code>x_2</code></strong>: The partial dependence plot for <code>x_2</code> resembles the shape of a bathtub, indicating that the extremes of its value range lead to higher predictions for the target variable, while a mean value of 0.5 correlates with the lowest target outcome. This suggests a non-linear relationship where both low and high values of <code>x_2</code> increase the target value, with a trough in the middle.</p></li>
<li><p><strong>Features <code>x_0</code> and <code>x_1</code></strong>: These features exhibit a steady monotonic increase in their impact on the target variable, which begins to plateau at higher input values. This plateau suggests that beyond a certain point, further increases in <code>x_0</code> or <code>x_1</code> have a diminished effect on the prediction.</p></li>
<li><p><strong>Remaining Features <code>x_3</code> and <code>x_4</code></strong>: The plots for <code>x_3</code> and <code>x_4</code> indicate that higher values of these features generally lead to higher predicted outcomes for the target variable. Notably, thereâ€™s a significant jump in the target prediction at around 0.4 for <code>x_3</code> and 0.6 for <code>x_4</code>, highlighting specific values where there might be a threshold effect or a strong non-linear influence.</p></li>
</ul>
<p>These insights from the partial dependence plots can guide further data analysis and model refinement. By understanding how each feature affects the target, we can prioritize features for engineering, adjust the model to better capture non-linear relationships, and potentially simplify the model by removing non-contributory noise features.</p>
</section>
<section id="exploring-feature-interactions-with-two-way-partial-dependence-plots" class="level3" data-number="5.4">
<h3 data-number="5.4" class="anchored" data-anchor-id="exploring-feature-interactions-with-two-way-partial-dependence-plots"><span class="header-section-number">5.4</span> Exploring Feature Interactions with Two-Way Partial Dependence Plots</h3>
<p>Partial dependence plots arenâ€™t limited to individual features; they can also be extended to explore the interactions between two features and their joint effect on the target variable. This two-dimensional analysis, known as a two-way partial dependence plot, provides a deeper understanding of how feature pairs contribute to the modelâ€™s predictions. Hereâ€™s how you would approach creating a two-way PDP:</p>
<ol type="1">
<li><p><strong>Select Two Features</strong>: Choose the two features you want to analyze for interaction.</p></li>
<li><p><strong>Create a Sample Grid</strong>: Construct a grid that is the Cartesian product of the individual grids for the two selected features. This means if you have 7 points for <code>x_0</code> and 7 for <code>x_1</code>, your sample grid will have 49 points representing all combinations of <code>x_0</code> and <code>x_1</code>.</p></li>
<li><p><strong>Expand the Dataset</strong>: Just as with the one-way PDP, you now apply this grid to the dataset. Each original datapoint is replaced by the set of new points from the grid, dramatically increasing the dataset size.</p></li>
<li><p><strong>Generate Predictions</strong>: Use the model to predict the target variable for this comprehensive grid, taking into account every combination of the two features.</p></li>
<li><p><strong>Compute the Average</strong>: By averaging the predictions across the grid for each combination, you can visualize the effect of varying both features simultaneously.</p></li>
</ol>
<p>The result is a contour plot or a three-dimensional surface plot that shows how changes in the two features together impact the predicted outcome. This gives insight into whether the features act independently on the target or if there are interaction effectsâ€”situations where the influence of one feature on the target depends on the value of the other feature.</p>
<p>Two-way partial dependence plots can help identify synergies or redundancies between features, informing decisions about feature engineering or model selection to better capture complex relationships within the data.</p>
<div id="cell-31" class="cell" data-execution_count="14">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1"></a>_, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>FIGSIZE)</span>
<span id="cb15-2"><a href="#cb15-2"></a></span>
<span id="cb15-3"><a href="#cb15-3"></a>PartialDependenceDisplay.from_estimator(</span>
<span id="cb15-4"><a href="#cb15-4"></a>    reg, X, features<span class="op">=</span>[(<span class="dv">1</span>, <span class="dv">2</span>)], grid_resolution<span class="op">=</span><span class="dv">128</span>, ax<span class="op">=</span>ax</span>
<span id="cb15-5"><a href="#cb15-5"></a>)</span>
<span id="cb15-6"><a href="#cb15-6"></a>plt.tight_layout()</span>
<span id="cb15-7"><a href="#cb15-7"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="dependency_files/figure-html/cell-15-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="bonus-individual-conditional-expectation" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="bonus-individual-conditional-expectation"><span class="header-section-number">6</span> Bonus: Individual Conditional Expectation ðŸ§Š</h2>
<p>Individual Conditional Expectation (ICE) plots diverge from the average effect shown in PDPs by tracing the response of each individual observation to changes in a feature. Hereâ€™s the distilled essence of ICE plots:</p>
<section id="focused-on-the-individual" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="focused-on-the-individual"><span class="header-section-number">6.1</span> Focused on the Individual</h3>
<p>Each line in an ICE plot represents the prediction path for a single observation as the feature of interest varies. This allows us to inspect how specific instances react to feature changes individually, rather than in aggregate.</p>
</section>
<section id="visual-diagnosis-of-variability" class="level3" data-number="6.2">
<h3 data-number="6.2" class="anchored" data-anchor-id="visual-diagnosis-of-variability"><span class="header-section-number">6.2</span> Visual Diagnosis of Variability</h3>
<p>ICE plots can reveal if different observations respond inconsistently to a feature change, showing increases for some and decreases for others. This can pinpoint performance issues not visible in PDPs.</p>
</section>
<section id="enhanced-model-understanding" class="level3" data-number="6.3">
<h3 data-number="6.3" class="anchored" data-anchor-id="enhanced-model-understanding"><span class="header-section-number">6.3</span> Enhanced Model Understanding</h3>
<p>By identifying how subsets of data are influenced by feature changes, ICE plots offer detailed insights into model behavior, helping to refine predictions and address potential issues at the individual level.</p>
<div id="cell-33" class="cell" data-execution_count="15">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1"></a>_, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">9</span>))</span>
<span id="cb16-2"><a href="#cb16-2"></a></span>
<span id="cb16-3"><a href="#cb16-3"></a>idx <span class="op">=</span> np.random.randint(<span class="bu">len</span>(X), size<span class="op">=</span><span class="bu">int</span>(<span class="bu">len</span>(X) <span class="op">*</span> <span class="fl">0.1</span>), dtype<span class="op">=</span><span class="bu">int</span>)</span>
<span id="cb16-4"><a href="#cb16-4"></a></span>
<span id="cb16-5"><a href="#cb16-5"></a></span>
<span id="cb16-6"><a href="#cb16-6"></a>PartialDependenceDisplay.from_estimator(</span>
<span id="cb16-7"><a href="#cb16-7"></a>    reg, X.loc[idx, :], features<span class="op">=</span>[<span class="dv">3</span>], kind<span class="op">=</span><span class="st">"both"</span>, grid_resolution<span class="op">=</span><span class="dv">128</span>, ax<span class="op">=</span>ax</span>
<span id="cb16-8"><a href="#cb16-8"></a>)</span>
<span id="cb16-9"><a href="#cb16-9"></a>ax.set_title(<span class="st">"Individual Condition Expectation"</span>)</span>
<span id="cb16-10"><a href="#cb16-10"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="dependency_files/figure-html/cell-16-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/jope35\.github\.io\/hypershotgun-blog\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // default icon
          link.classList.add("external");
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>